<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º ‚ú®</title>
   <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
   
    body {
      overflow: hidden;
      background: #000;
      font-family: 'Arial', sans-serif;
    }
   
    #start {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, #1a0a3e 0%, #000 100%);
      z-index: 10;
      animation: bgPulse 4s ease-in-out infinite;
    }
   
    @keyframes bgPulse {
      0%, 100% { background: radial-gradient(circle at center, #1a0a3e 0%, #000 100%); }
      50% { background: radial-gradient(circle at center, #2a1a4e 0%, #000 100%); }
    }
   
    button {
      font-size: 28px;
      padding: 30px 60px;
      border-radius: 60px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #ff006e 0%, #8338ec 50%, #3a86ff 100%);
      background-size: 200% 200%;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 15px 60px rgba(131, 56, 236, 0.6),
                  inset 0 1px 0 rgba(255,255,255,0.4);
      transition: all 0.4s ease;
      text-transform: uppercase;
      letter-spacing: 4px;
      position: relative;
      overflow: hidden;
      animation: gradientShift 3s ease infinite;
    }
   
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
   
    button::before {
      content: '‚ú®';
      position: absolute;
      top: 50%;
      left: -40px;
      transform: translateY(-50%);
      font-size: 24px;
      animation: sparkleMove 2s ease-in-out infinite;
    }
   
    button::after {
      content: '‚ú®';
      position: absolute;
      top: 50%;
      right: -40px;
      transform: translateY(-50%);
      font-size: 24px;
      animation: sparkleMove 2s ease-in-out infinite reverse;
    }
   
    @keyframes sparkleMove {
      0%, 100% { opacity: 0; transform: translateY(-50%) scale(0.5); }
      50% { opacity: 1; transform: translateY(-50%) scale(1.2); }
    }
   
    button:hover {
      transform: scale(1.08) translateY(-3px);
      box-shadow: 0 20px 80px rgba(131, 56, 236, 0.9),
                  inset 0 1px 0 rgba(255,255,255,0.6);
    }
   
    button:active {
      transform: scale(1.02) translateY(-1px);
    }
   
    #loading {
      color: #8338ec;
      font-size: 20px;
      margin-top: 30px;
      text-shadow: 0 0 30px rgba(131, 56, 236, 0.9);
      opacity: 0;
      transition: opacity 0.4s;
      letter-spacing: 2px;
    }
   
    #progress {
      position: fixed;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 25px rgba(255, 255, 255, 0.9),
                   0 0 50px rgba(131, 56, 236, 0.6);
      z-index: 5;
      opacity: 0;
      transition: opacity 0.6s;
      text-align: center;
      letter-spacing: 3px;
      max-width: 90%;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
   
    #music-controls {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
      display: flex;
      gap: 15px;
      opacity: 0;
      transition: opacity 0.6s;
    }
   
    .music-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(131, 56, 236, 0.3);
      border: 3px solid #8338ec;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      transition: all 0.4s;
      padding: 0;
      letter-spacing: 0;
      box-shadow: 0 5px 25px rgba(131, 56, 236, 0.4);
    }
   
    .music-btn:hover {
      background: rgba(131, 56, 236, 0.6);
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 8px 35px rgba(131, 56, 236, 0.7);
    }
   
    .music-btn:active {
      transform: scale(1.05);
    }
   
    @keyframes glow {
      0%, 100% {
        text-shadow: 0 0 25px rgba(255, 255, 255, 0.9),
                     0 0 50px rgba(131, 56, 236, 0.6);
      }
      50% {
        text-shadow: 0 0 40px rgba(255, 255, 255, 1),
                     0 0 80px rgba(255, 0, 110, 0.8);
      }
    }

   /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
  button {
    font-size: 20px;
    padding: 20px 40px;
    letter-spacing: 2px;
  }
  
  #loading {
    font-size: 16px;
  }
  
  #progress {
    font-size: 18px;
    padding: 12px 15px;
    bottom: 70px;
    letter-spacing: 1px;
  }
  
  .music-btn {
    width: 50px;
    height: 50px;
    font-size: 20px;
  }
  
  #music-controls {
    bottom: 20px;
    right: 20px;
    gap: 10px;
  }
}

/* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width: 480px) {
  button {
    font-size: 18px;
    padding: 18px 35px;
    border-radius: 50px;
  }
  
  #progress {
    font-size: 16px;
    padding: 10px 12px;
    bottom: 80px;
  }
  
  .music-btn {
    width: 45px;
    height: 45px;
    font-size: 18px;
  }
}


  </style>
</head>
<body>

<div id="start">
  <button id="go">üéÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∞–≥–∏—é üéÑ</button>
  <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</div>
</div>

<div id="progress"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
// ========== –ö–õ–ê–°–°–´ –ó–ê–ì–†–£–ó–ß–ò–ö–û–í ==========

class OBJLoader {
  load(url, onLoad, onProgress, onError) {
    fetch(url)
      .then(response => response.text())
      .then(text => {
        const geometry = this.parse(text);
        if (onLoad) onLoad(geometry);
      })
      .catch(err => {
        console.error('OBJ load error:', err);
        if (onError) onError(err);
      });
  }
  
  parse(text) {
    const vertices = [];
    const normals = [];
    const uvs = [];
    const faces = [];
    
    const lines = text.split('\n');
    lines.forEach(line => {
      const parts = line.trim().split(/\s+/);
      
      if (parts[0] === 'v') {
        vertices.push(
          parseFloat(parts[1]),
          parseFloat(parts[2]),
          parseFloat(parts[3])
        );
      } else if (parts[0] === 'vn') {
        normals.push(
          parseFloat(parts[1]),
          parseFloat(parts[2]),
          parseFloat(parts[3])
        );
      } else if (parts[0] === 'vt') {
        uvs.push(
          parseFloat(parts[1]),
          parseFloat(parts[2])
        );
      } else if (parts[0] === 'f') {
        const face = [];
        for (let i = 1; i < parts.length; i++) {
          const indices = parts[i].split('/');
          face.push({
            v: parseInt(indices[0]) - 1,
            vt: indices[1] ? parseInt(indices[1]) - 1 : null,
            vn: indices[2] ? parseInt(indices[2]) - 1 : null
          });
        }
        faces.push(face);
      }
    });
    
    const geometry = new THREE.BufferGeometry();
    const positions = [];
    const norms = [];
    const uvsArray = [];
    
    faces.forEach(face => {
      if (face.length >= 3) {
        for (let i = 0; i < 3; i++) {
          const idx = face[i];
          if (idx.v * 3 + 2 < vertices.length) {
            positions.push(
              vertices[idx.v * 3],
              vertices[idx.v * 3 + 1],
              vertices[idx.v * 3 + 2]
            );
          }
          if (idx.vn !== null && idx.vn * 3 + 2 < normals.length) {
            norms.push(
              normals[idx.vn * 3],
              normals[idx.vn * 3 + 1],
              normals[idx.vn * 3 + 2]
            );
          }
          if (idx.vt !== null && idx.vt * 2 + 1 < uvs.length) {
            uvsArray.push(
              uvs[idx.vt * 2],
              uvs[idx.vt * 2 + 1]
            );
          }
        }
      }
    });
    
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    if (norms.length > 0) {
      geometry.setAttribute('normal', new THREE.Float32BufferAttribute(norms, 3));
    } else {
      geometry.computeVertexNormals();
    }
    if (uvsArray.length > 0) {
      geometry.setAttribute('uv', new THREE.Float32BufferAttribute(uvsArray, 2));
    }
    
    return geometry;
  }
}

class GLTFLoader {
  load(url, onLoad, onProgress, onError) {
    fetch(url)
      .then(response => response.arrayBuffer())
      .then(buffer => {
        console.log('GLTF creating space scene');
        const group = new THREE.Group();
        
        // –ó–≤–µ–∑–¥—ã —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ —Ü–≤–µ—Ç–æ–≤
        for (let i = 0; i < 2000; i++) {
          const size = Math.random() * 0.2 + 0.03;
          const hue = Math.random() * 0.2 + 0.55;
          const star = new THREE.Mesh(
            new THREE.SphereGeometry(size, 6, 6),
            new THREE.MeshBasicMaterial({ 
              color: new THREE.Color().setHSL(hue, 0.3, Math.random() * 0.4 + 0.6)
            })
          );
          star.position.set(
            (Math.random() - 0.5) * 200,
            (Math.random() - 0.5) * 200,
            (Math.random() - 0.5) * 200
          );
          group.add(star);
        }
        
        // –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏
        for (let i = 0; i < 30; i++) {
          const nebula = new THREE.Mesh(
            new THREE.SphereGeometry(Math.random() * 4 + 2, 8, 8),
            new THREE.MeshBasicMaterial({ 
              color: new THREE.Color().setHSL(Math.random() * 0.3 + 0.5, 0.9, 0.4),
              transparent: true,
              opacity: 0.15
            })
          );
          nebula.position.set(
            (Math.random() - 0.5) * 120,
            (Math.random() - 0.5) * 120,
            (Math.random() - 0.5) * 120
          );
          group.add(nebula);
        }
        
        if (onLoad) onLoad({ scene: group });
      })
      .catch(err => {
        console.error('GLTF load error, using fallback');
        const group = new THREE.Group();
        for (let i = 0; i < 1500; i++) {
          const star = new THREE.Mesh(
            new THREE.SphereGeometry(0.1, 6, 6),
            new THREE.MeshBasicMaterial({ color: 0xffffff })
          );
          star.position.set(
            (Math.random() - 0.5) * 150,
            (Math.random() - 0.5) * 150,
            (Math.random() - 0.5) * 150
          );
          group.add(star);
        }
        if (onLoad) onLoad({ scene: group });
      });
  }
}

// ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========




const startBtn = document.getElementById("go");
const startScreen = document.getElementById("start");
const progressDiv = document.getElementById("progress");
const loadingDiv = document.getElementById("loading");
let scene, camera, renderer;
let girl, note, cityScene, spaceScene;
let phase = 0, time = 0;
let vortexParticles = [], magicParticles = [], snowflakes = [];
let modelsLoaded = 0;
const totalModels = 4;
let audio = null;
let audioLoaded = false;
let musicStarted = false;
let snowStarted = false;
const gltfLoader = new GLTFLoader(); // custom for space
const gltfLoaderGirl = new THREE.GLTFLoader(); // standard for girl
const gltfLoaderCity = new THREE.GLTFLoader(); // standard for city


// ========== –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò ==========

startBtn.onclick = () => {
  loadingDiv.style.opacity = "1";
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
  initAudio();
  loadAssets();
};

function loadAssets() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–≤—É—à–∫–∏ —Å —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏
  gltfLoaderGirl.load(
  'assets/girl.glb',  // –∏–ª–∏ 'assets/girl.gltf' ‚Äî —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
  (gltf) => {
    girl = gltf.scene;  // –í–∞–∂–Ω–æ: gltf.scene, –∞ –Ω–µ geometry
    
    // –ú–∞—Å—à—Ç–∞–± (–ø–æ–¥–±–µ—Ä–∏—Ç–µ –ø–æ–¥ –≤–∞—à—É –º–æ–¥–µ–ª—å, —Ä–∞–Ω—å—à–µ –±—ã–ª–æ 0.8)
    girl.scale.set(0.8, 0.8, 0.8);
    
    // –ü–æ–∑–∏—Ü–∏—è (—Ä–∞–Ω—å—à–µ -0.3 –ø–æ Y)
    girl.position.set(0, -0.3, 0);
    
    // –¢–µ–Ω–∏
    girl.traverse((child) => {
      if (child.isMesh) {
        child.castShadow = true;
        child.receiveShadow = true;
        
        // –ï—Å–ª–∏ –≤ –º–æ–¥–µ–ª–∏ —É–∂–µ –µ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∏—Ö
        // –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å vertex colors –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª ‚Äî –¥–µ–ª–∞–π—Ç–µ –∑–¥–µ—Å—å
      }
    });
    
    console.log('Girl GLB model loaded');
    modelLoaded();
  },
  undefined,  // onProgress (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  (err) => {
    console.warn('Girl GLB load error, using fallback');
    createFallbackGirl();
    modelLoaded();
  }
);
  
  // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å–∫—É (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º)
  createNote();
  modelLoaded();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ä–æ–¥–∞
  const gltfLoaderCity = new THREE.GLTFLoader();

gltfLoaderCity.load(
  'assets/city.glb',  // –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –Ω–æ–≤–æ–º—É —Ñ–∞–π–ª—É
  (gltf) => {
    cityScene = gltf.scene;
    cityScene.scale.set(0.5, 0.5, 0.5);
    cityScene.position.set(0, -10, -20);

    // –¢–µ–Ω–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    cityScene.traverse((child) => {
      if (child.isMesh) {
        child.castShadow = true;
        child.receiveShadow = true;
      }
    });

    console.log('City GLB model loaded');
    modelLoaded();
  },
  undefined,
  (err) => {
    console.warn('City GLB load error, using fallback');
    createFallbackCity();
    modelLoaded();
  }
);
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Å–º–æ—Å–∞
  gltfLoader.load(
    'assets/space.glb',
    (gltf) => {
      spaceScene = gltf.scene;
      spaceScene.scale.set(10, 10, 10);
      spaceScene.visible = false;
      console.log('Space scene loaded');
      modelLoaded();
    },
    undefined,
    (err) => {
      console.warn('Space model error, using fallback');
      createFallbackSpace();
      modelLoaded();
    }
  );
}

function createFallbackGirl() {
  const group = new THREE.Group();
  
  // –¢–µ–ª–æ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
  const bodyGeo = new THREE.CylinderGeometry(0.3, 0.4, 1.5, 16);
  const positions = bodyGeo.attributes.position.array;
  const colors = [];
  
  for (let i = 0; i < positions.length; i += 3) {
    const y = positions[i + 1];
    const hue = 0.9 - y * 0.3;
    const color = new THREE.Color().setHSL(hue, 0.8, 0.6);
    colors.push(color.r, color.g, color.b);
  }
  
  bodyGeo.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
  
  const bodyMat = new THREE.MeshStandardMaterial({
    vertexColors: true,
    roughness: 0.7
  });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = 0.75;
  body.castShadow = true;
  
  const headGeo = new THREE.SphereGeometry(0.25, 16, 16);
  const headMat = new THREE.MeshStandardMaterial({ color: 0xffccaa });
  const head = new THREE.Mesh(headGeo, headMat);
  head.position.y = 1.6;
  head.castShadow = true;
  
  group.add(body, head);
  girl = group;
  girl.position.set(0, -0.5, 0);
}

function createNote() {
  const group = new THREE.Group();
  
  // –ö–æ–Ω–≤–µ—Ä—Ç
  const envelopeGeo = new THREE.BoxGeometry(0.5, 0.02, 0.35);
  const envelopeMat = new THREE.MeshStandardMaterial({ 
    color: 0xfff8dc,
    emissive: 0xffd700,
    emissiveIntensity: 0,
    roughness: 0.5
  });
  const envelope = new THREE.Mesh(envelopeGeo, envelopeMat);
  envelope.castShadow = true;
  group.add(envelope);
  
  // –ó–æ–ª–æ—Ç–∞—è –ø–µ—á–∞—Ç—å
  const sealGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.03, 16);
  const sealMat = new THREE.MeshStandardMaterial({ 
    color: 0xd4af37,
    metalness: 0.9,
    roughness: 0.1,
    emissive: 0xffd700,
    emissiveIntensity: 0.5
  });
  const seal = new THREE.Mesh(sealGeo, sealMat);
  seal.rotation.x = Math.PI / 2;
  seal.position.y = 0.025;
  seal.castShadow = true;
  group.add(seal);
  
  // –ë–ª–µ—Å—Ç–∫–∏ –Ω–∞ –ø–µ—á–∞—Ç–∏
  for (let i = 0; i < 8; i++) {
    const angle = (i / 8) * Math.PI * 2;
    const sparkle = new THREE.Mesh(
      new THREE.SphereGeometry(0.015, 6, 6),
      new THREE.MeshBasicMaterial({ color: 0xffff00 })
    );
    sparkle.position.set(
      Math.cos(angle) * 0.06,
      0.035,
      Math.sin(angle) * 0.06
    );
    group.add(sparkle);
  }
  
  note = group;
  note.position.set(0, 0.2, 0.8);
}

function createFallbackCity() {
  cityScene = new THREE.Group();
  
  // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –∑–∏–º–Ω–∏–π –≥–æ—Ä–æ–¥
  for (let i = 0; i < 30; i++) {
    const height = Math.random() * 5 + 1.5;
    const width = Math.random() * 0.8 + 0.4;
    const buildingGeo = new THREE.BoxGeometry(width, height, width);
    const hue = 0.6 + Math.random() * 0.1;
    const buildingMat = new THREE.MeshStandardMaterial({
      color: new THREE.Color().setHSL(hue, 0.4, 0.25),
      emissive: new THREE.Color().setHSL(0.15, 1, 0.3),
      emissiveIntensity: Math.random() * 0.4 + 0.1,
      roughness: 0.8
    });
    const building = new THREE.Mesh(buildingGeo, buildingMat);
    building.castShadow = true;
    
    const angle = (i / 30) * Math.PI * 2;
    const radius = 7 + Math.random() * 4;
    building.position.set(
      Math.cos(angle) * radius,
      height / 2,
      Math.sin(angle) * radius
    );
    
    // –û–∫–Ω–∞
    for (let j = 0; j < 5; j++) {
      if (Math.random() > 0.3) {
        const windowLight = new THREE.Mesh(
          new THREE.BoxGeometry(0.1, 0.15, 0.01),
          new THREE.MeshBasicMaterial({ color: 0xffeb3b })
        );
        windowLight.position.set(0, j * 0.6 - height/3, width/2 + 0.01);
        building.add(windowLight);
      }
    }
    
    cityScene.add(building);
  }
  
  // –ï–ª–∫–∏
  for (let i = 0; i < 10; i++) {
    const tree = new THREE.Mesh(
      new THREE.ConeGeometry(0.3, 0.8, 8),
      new THREE.MeshStandardMaterial({ color: 0x2d5016 })
    );
    const angle = Math.random() * Math.PI * 2;
    const radius = 5 + Math.random() * 3;
    tree.position.set(
      Math.cos(angle) * radius,
      0.4,
      Math.sin(angle) * radius
    );
    cityScene.add(tree);
  }
  
  cityScene.position.set(0, -10, -20);
}

function createFallbackSpace() {
  spaceScene = new THREE.Group();
  
  for (let i = 0; i < 2000; i++) {
    const size = Math.random() * 0.15 + 0.04;
    const star = new THREE.Mesh(
      new THREE.SphereGeometry(size, 6, 6),
      new THREE.MeshBasicMaterial({ 
        color: new THREE.Color().setHSL(0.6, 0.2, Math.random() * 0.5 + 0.5)
      })
    );
    star.position.set(
      (Math.random() - 0.5) * 200,
      (Math.random() - 0.5) * 200,
      (Math.random() - 0.5) * 200
    );
    spaceScene.add(star);
  }
  
  spaceScene.visible = false;
}

function modelLoaded() {
  modelsLoaded++;
  loadingDiv.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞... ${modelsLoaded}/${totalModels}`;
  
  if (modelsLoaded === totalModels) {
    setTimeout(() => {
      startScreen.style.transition = "opacity 1s";
      startScreen.style.opacity = "0";
      setTimeout(() => {
        startScreen.remove();
        init();
      }, 1000);
    }, 500);
  }
}


// ========== –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê ==========

function initAudio() {
  audio = new Audio('assets/song.mp3');
  audio.loop = true;
  audio.volume = 0.6;
  
  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞
  audio.load();
  
  audio.addEventListener('canplaythrough', () => {
    audioLoaded = true;
    console.log('–ú—É–∑—ã–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
  });
  
  audio.addEventListener('error', (e) => {
    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º—É–∑—ã–∫–∏:', e);
    console.log('–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –º—É–∑—ã–∫–∏');
  });
  
  // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
  const musicControls = document.getElementById('music-controls');
  const playBtn = document.getElementById('play-btn');
  const pauseBtn = document.getElementById('pause-btn');
  const volumeUp = document.getElementById('volume-up');
  const volumeDown = document.getElementById('volume-down');

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É (–∏–ª–∏ –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç ‚Äî –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ)
  musicControls.style.opacity = '1';

  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è play/pause
  function togglePlayPause() {
    if (audio.paused) {
      audio.play().catch(e => {
        console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e);
        alert('–ù–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏');
      });
      playBtn.style.display = 'none';
      pauseBtn.style.display = 'flex';
    } else {
      audio.pause();
      playBtn.style.display = 'flex';
      pauseBtn.style.display = 'none';
    }
  }

  // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ –æ–±–µ –∫–Ω–æ–ø–∫–∏
  playBtn.onclick = togglePlayPause;
  pauseBtn.onclick = togglePlayPause;

  // –ì—Ä–æ–º–∫–æ—Å—Ç—å
  volumeUp.onclick = () => {
    audio.volume = Math.min(1, audio.volume + 0.1);
  };
  
  volumeDown.onclick = () => {
    audio.volume = Math.max(0, audio.volume - 0.1);
  };

  // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–∞—É–∑—ã (–µ—Å–ª–∏ –º—É–∑—ã–∫–∞ –±—É–¥–µ—Ç –∏–≥—Ä–∞—Ç—å)
  playBtn.style.display = 'none';
  pauseBtn.style.display = 'flex';
}

function startMusic() {
  if (audio && !audio.paused) return; // –£–∂–µ –∏–≥—Ä–∞–µ—Ç
  
  audio.play().catch(e => {
    console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º');
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É play, –µ—Å–ª–∏ –Ω–µ –≤–∏–¥–Ω–∞
    document.getElementById('play-btn').style.display = 'flex';
    document.getElementById('pause-btn').style.display = 'none';
  });
}



// ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–¶–ï–ù–´ ==========

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000510);
  scene.fog = new THREE.Fog(0x000510, 5, 40);

  camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
  camera.position.set(0, 1.5, 5);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // –û—Å–≤–µ—â–µ–Ω–∏–µ
  const ambientLight = new THREE.AmbientLight(0x4a5f88, 0.5);
  scene.add(ambientLight);

  const mainLight = new THREE.DirectionalLight(0xaaddff, 0.8);
  mainLight.position.set(5, 10, 5);
  mainLight.castShadow = true;
  mainLight.shadow.mapSize.width = 2048;
  mainLight.shadow.mapSize.height = 2048;
  scene.add(mainLight);

  const fillLight = new THREE.DirectionalLight(0xff9966, 0.3);
  fillLight.position.set(-5, 3, -3);
  scene.add(fillLight);

  const magicLight = new THREE.PointLight(0xffd700, 3, 10);
  magicLight.position.set(0, 0.5, 0.8);
  scene.add(magicLight);

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
  if (girl) scene.add(girl);
  if (note) scene.add(note);
  if (cityScene) scene.add(cityScene);
  if (spaceScene) scene.add(spaceScene);

  createGround();
  createVortex();
  createMagicParticles();
  createSnowflakes();

  progressDiv.style.opacity = "1";
  progressDiv.textContent = "–ü–∏—Å—å–º–æ —Å–≤–µ—Ç–∏—Ç—Å—è –º–∞–≥–∏–µ–π... ‚ú®";
  
  animate();
}

function createGround() {
  const groundGeo = new THREE.PlaneGeometry(30, 30);
  const groundMat = new THREE.MeshStandardMaterial({ 
    color: 0x1a2332,
    roughness: 0.9
  });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = -0.5;
  ground.receiveShadow = true;
  scene.add(ground);
  
  // –ö–∞–º–Ω–∏
  for (let i = 0; i < 10; i++) {
    const rockGeo = new THREE.DodecahedronGeometry(Math.random() * 0.4 + 0.2, 0);
    const rockMat = new THREE.MeshStandardMaterial({ 
      color: 0x3a3a3a,
      roughness: 1
    });
    const rock = new THREE.Mesh(rockGeo, rockMat);
    rock.position.set(
      (Math.random() - 0.5) * 5,
      -0.3,
      (Math.random() - 0.5) * 4 + 0.5
    );
    rock.rotation.set(
      Math.random() * Math.PI,
      Math.random() * Math.PI,
      Math.random() * Math.PI
    );
    rock.castShadow = true;
    scene.add(rock);
  }
}

function createVortex() {
  for (let i = 0; i < 500; i++) {
    const hue = (i / 500) * 0.3 + 0.5;
    const particle = new THREE.Mesh(
      new THREE.SphereGeometry(0.05, 8, 8),
      new THREE.MeshBasicMaterial({
        color: new THREE.Color().setHSL(hue, 1, 0.6),
        transparent: true,
        opacity: 0.85
      })
    );
    particle.visible = false;
    scene.add(particle);
    vortexParticles.push(particle);
  }
}

function createMagicParticles() {
  for (let i = 0; i < 150; i++) {
    const particle = new THREE.Mesh(
      new THREE.SphereGeometry(0.04, 8, 8),
      new THREE.MeshBasicMaterial({
        color: 0xffd700,
        transparent: true,
        opacity: 0
      })
    );
    scene.add(particle);
    magicParticles.push({
      mesh: particle,
      velocity: new THREE.Vector3(),
      angle: (i / 150) * Math.PI * 2,
      speed: Math.random() * 0.5 + 0.5
    });
  }
}


function createSnowflakes() {
  for (let i = 0; i < 300; i++) {
    const snowflake = new THREE.Mesh(
      new THREE.SphereGeometry(0.03, 6, 6),
      new THREE.MeshBasicMaterial({
        color: 0xffffff,
        transparent: true,
        opacity: 0 // –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ
      })
    );
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏ –ø–æ –≤—Å–µ–π —Å—Ü–µ–Ω–µ
    snowflake.position.set(
      (Math.random() - 0.5) * 30,  // —à–∏—Ä–µ –ø–æ X
      Math.random() * 20 + 5,       // –≤—ã—à–µ –ø–æ Y
      (Math.random() - 0.5) * 30 - 10 // –≥–ª—É–±–∂–µ –ø–æ Z
    );
    
    scene.add(snowflake);
    snowflakes.push({
      mesh: snowflake,
      velocity: new THREE.Vector3(
        (Math.random() - 0.5) * 0.02,
        -Math.random() * 0.03 - 0.01,
        (Math.random() - 0.5) * 0.02
      ),
      resetY: Math.random() * 10 + 8
    });
  }
}
// ===

function startSnowfall() {
  if (snowStarted) return; // –ß—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
  
  snowStarted = true;
  console.log("–°–Ω–µ–≥–æ–ø–∞–¥ –Ω–∞—á–∞–ª—Å—è! ‚ùÑÔ∏è");
  
  // –ú—è–≥–∫–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–Ω–µ–∂–∏–Ω–∫–∏
  snowflakes.forEach(s => {
    // –ú—è–≥–∫–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
    gsap.to(s.mesh.material, {
      opacity: 0.8 + Math.random() * 0.2,
      duration: 2,
      ease: "power2.out"
    });
  });
}


// ========== –ê–ù–ò–ú–ê–¶–ò–Ø ==========

function animate() {
  requestAnimationFrame(animate);
  time += 0.016;

  // –§–∞–∑–∞ 0: –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞
  if (phase === 0) {
    if (note) {
      note.rotation.y = Math.sin(time * 2) * 0.3;
      note.position.y = 0.2 + Math.sin(time * 3) * 0.05;
      
      if (note.children[0]) {
        note.children[0].material.emissiveIntensity = Math.sin(time * 4) * 0.4 + 0.4;
      }
    }
    
    magicParticles.forEach((p, i) => {
      const angle = p.angle + time * 2 * p.speed;
      const radius = 0.5 + Math.sin(time * 3 + i * 0.1) * 0.1;
      p.mesh.position.set(
        Math.cos(angle) * radius,
        0.3 + Math.sin(time * 3 + i * 0.1) * 0.15,
        0.8 + Math.sin(angle) * radius
      );
      p.mesh.material.opacity = Math.sin(time * 4 + i) * 0.4 + 0.5;
    });
    
    if (time > 3) {
      phase = 1;
      progressDiv.innerHTML = "üì® <span style='color:#ff6b9d;text-shadow:0 0 10px #ff6b9d'>–í–æ–ª—à–µ–±–Ω–æ–µ –ø–∏—Å—å–º–æ —É–Ω–æ—Å–∏—Ç –≤ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –≥–æ—Ä–æ–¥</span> üì®";
    }
  }

  // –§–∞–∑–∞ 1: –ü–∏—Å—å–º–æ –∫ –¥–µ–≤—É—à–∫–µ
  else if (phase === 1) {
    if (note) {
      note.position.y += 0.025;
      note.position.z += (0.1 - note.position.z) * 0.05;
      note.rotation.x += 0.02;
    }
    
    camera.position.z += (4 - camera.position.z) * 0.02;
    camera.position.y += (1.3 - camera.position.y) * 0.02;
    
    magicParticles.forEach(p => {
      p.mesh.position.y += 0.02;
    });
    
    if (note && note.position.y > 1.2) {
      phase = 2;
      progressDiv.innerHTML = "üöÄ <span style='color:#4fc3f7;text-shadow:0 0 10px #4fc3f7'>–ó–∞–ø—É—Å–∫ –≤ –∑–≤—ë–∑–¥–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ!</span> ‚ú®";
      // –ó–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É
      startMusic();
    }
  }

  // –§–∞–∑–∞ 2: –ü–æ–ª–µ—Ç –≤ –∫–æ—Å–º–æ—Å
  else if (phase === 2) {
    if (spaceScene) {
      spaceScene.visible = true;
      spaceScene.rotation.y += 0.002;
      spaceScene.rotation.x += 0.001;
    }
    
    scene.fog.far += 3;
    scene.background.lerp(new THREE.Color(0x000020), 0.02);
    
    if (girl) {
      girl.position.z -= 0.18;
      girl.rotation.y += 0.04;
      girl.position.y += 0.01;
    }
    
    if (note) {
      note.position.z -= 0.18;
      note.rotation.x += 0.06;
      note.rotation.y += 0.04;
    }
    
    camera.position.z -= 0.18;
    camera.position.y += 0.03;
    
    // –ó–ê–ü–£–°–ö –°–ù–ï–ì–û–ü–ê–î–ê
    if (!snowStarted) startSnowfall();
    
    vortexParticles.forEach((p, i) => {
      p.visible = true;
      const angle = (i / vortexParticles.length) * Math.PI * 2 + time * 3;
      const radius = 2.5 + Math.sin(time * 2 + i * 0.1) * 0.8;
      const height = (i / vortexParticles.length) * 12;
      
      p.position.set(
        Math.cos(angle) * radius,
        height + time * 2.5,
        camera.position.z - 12 + Math.sin(angle) * radius
      );
    });
    
    if (time > 9) {
      phase = 3;
      progressDiv.innerHTML = "üåÄ <span style='color:#ffd700;text-shadow:0 0 10px #ffd700'>–í–∏—Ö—Ä—å –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–π –º–∞–≥–∏–∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!</span> ‚ùÑÔ∏è";
    }
  }

  // –§–∞–∑–∞ 3: –°–∏–ª—å–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –≤ –≤–∏—Ö—Ä–µ
  else if (phase === 3) {
    if (girl) {
      girl.rotation.y += 0.12;
      girl.rotation.x += 0.03;
      girl.rotation.z += 0.02;
    }
    
    if (note) {
      note.rotation.y += 0.15;
      note.rotation.x += 0.1;
    }
    
    camera.rotation.z += 0.015;
    camera.rotation.x += 0.005;
    
    vortexParticles.forEach((p, i) => {
      const angle = (i / vortexParticles.length) * Math.PI * 2 + time * 6;
      const radius = 2;
      
      p.position.set(
        camera.position.x + Math.cos(angle) * radius,
        camera.position.y + Math.sin(angle * 3) * radius,
        camera.position.z - 8 + Math.sin(angle) * radius
      );
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ —Å–Ω–µ–≥ –∫—Ä—É–∂–∏—Ç—Å—è –≤ –≤–∏—Ö—Ä–µ
    if (snowStarted) {
      snowflakes.forEach(s => {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞—â–∞—Ç–µ–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        s.velocity.x += Math.sin(time * 2) * 0.001;
        s.velocity.z += Math.cos(time * 2) * 0.001;
        
        // –£—Å–∫–æ—Ä—è–µ–º –ø–∞–¥–µ–Ω–∏–µ
        s.velocity.y = -Math.random() * 0.05 - 0.02;
      });
    }
    
    // –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
    if (Math.random() > 0.98) {
      const messages = [
        "–ö–∞–∂–¥–∞—è —Å–Ω–µ–∂–∏–Ω–∫–∞ –Ω–µ—Å—ë—Ç —á—É–¥–æ! ‚ùÑÔ∏è",
        "–í—Ä–µ–º—è –∑–∞–≥–∞–¥—ã–≤–∞—Ç—å –∂–µ–ª–∞–Ω–∏—è! üí´",
        "–ú–∞–≥–∏—è —É–∂–µ —Å —Ç–æ–±–æ–π! ‚ú®",
        "–ù–æ–≤—ã–π –≥–æ–¥ —Å—Ç—É—á–∏—Ç—Å—è –≤ —Å–µ—Ä–¥—Ü–µ! üéÅ"
      ];
      progressDiv.innerHTML = "üåü " + messages[Math.floor(Math.random() * messages.length)] + " üåü";
    }
    
    if (time > 13) {
      phase = 4;
      progressDiv.innerHTML = "üèôÔ∏è <span style='color:#69f0ae;text-shadow:0 0 10px #69f0ae'>–í–æ–ª—à–µ–±–Ω—ã–π –≥–æ—Ä–æ–¥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏–∑ —Å–Ω–µ–≥–æ–≤!</span> üéÑ";
    }
  }

  // –§–∞–∑–∞ 4: –ü–æ—è–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
  else if (phase === 4) {
    if (cityScene) {
      cityScene.position.y += (0 - cityScene.position.y) * 0.04;
      cityScene.position.z += (-5 - cityScene.position.z) * 0.04;
      cityScene.rotation.y += 0.008;
    }
    
    if (girl) {
      girl.position.set(
        girl.position.x * 0.95,
        0,
        -3
      );
      girl.rotation.x += (0 - girl.rotation.x) * 0.08;
      girl.rotation.z += (0 - girl.rotation.z) * 0.08;
      girl.rotation.y += 0.03;
    }
    
    if (note) {
      note.position.y += (1.5 - note.position.y) * 0.05;
      note.position.z = -2.5;
      note.rotation.x += (0 - note.rotation.x) * 0.1;
    }
    
    camera.position.y += (2.5 - camera.position.y) * 0.04;
    camera.position.z += (5 - camera.position.z) * 0.04;
    camera.rotation.z *= 0.92;
    camera.rotation.x *= 0.92;
    
    vortexParticles.forEach(p => {
      p.material.opacity -= 0.006;
      if (p.material.opacity <= 0) p.visible = false;
    });
    
    if (spaceScene) {
      spaceScene.traverse(child => {
        if (child.material && child.material.opacity !== undefined) {
          child.material.transparent = true;
          child.material.opacity -= 0.01;
        }
      });
    }
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–Ω–µ–≥—É –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    if (snowStarted) {
      snowflakes.forEach(s => {
        s.velocity.x = (Math.random() - 0.5) * 0.02;
        s.velocity.y = -Math.random() * 0.03 - 0.01;
        s.velocity.z = (Math.random() - 0.5) * 0.02;
      });
    }
    
    scene.background.lerp(new THREE.Color(0x0a1520), 0.03);
    
    if (time > 18) {
      phase = 5;
      // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const isMobile = window.innerWidth <= 768;
      progressDiv.innerHTML = `
        <div style="text-align: center; max-width: 95%; margin: 0 auto; padding: 10px;">
          <div style="
            font-size: ${isMobile ? '24px' : '32px'}; 
            margin-bottom: ${isMobile ? '5px' : '10px'}; 
            color:#ff3366; 
            text-shadow:0 0 20px #ff3366;
            line-height: 1.2;
          ">
            –° –ù–û–í–´–ú 2026 –ì–û–î–û–ú!
          </div>
          <div style="
            font-size: ${isMobile ? '18px' : '22px'}; 
            color:#4fc3f7; 
            text-shadow:0 0 15px #4fc3f7;
            line-height: 1.3;
            margin-bottom: 8px;
          ">
            –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –º–∏–≥ –±—É–¥–µ—Ç –≤–æ–ª—à–µ–±–Ω—ã–º! ‚ú®
          </div>
          <div style="
            font-size: ${isMobile ? '16px' : '18px'}; 
            color:#ffd700;
            line-height: 1.2;
          ">
            –ú–µ—á—Ç—ã —Å–±—ã–≤–∞—é—Ç—Å—è, –∞ —Å—á–∞—Å—Ç—å–µ –º–Ω–æ–∂–∏—Ç—Å—è! üí´üéÅüéÜ
          </div>
        </div>
      `;
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–æ–π
      document.getElementById('music-controls').style.opacity = '1';
    }
  }

  // –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞
  else if (phase === 5) {
    if (cityScene) {
      cityScene.rotation.y += 0.005;
     
      // –Ø—Ä–∫–æ–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ
      cityScene.traverse(child => {
        if (child.isMesh && child.material.emissive) {
          child.material.emissiveIntensity = 0.4 + Math.sin(time * 12 + child.id * 0.1) * 0.4;
        }
      });
    }
   
    if (girl) {
      girl.rotation.y += 0.018;
      girl.position.y = Math.sin(time * 1.8) * 0.06;
    }
   
    if (note) {
      note.rotation.y += 0.025;
      note.position.y = 1.6 + Math.sin(time * 2.2) * 0.04;
     
      // –†–∞–¥—É–∂–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –ø–∏—Å—å–º–∞
      if (note.children[0]) {
        const hue = (time * 0.2) % 1;
        note.children[0].material.emissive.setHSL(hue, 1, 0.5);
      }
    }
   
    // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
    camera.position.x += Math.sin(time * 0.5) * 0.018;
    camera.position.y += Math.cos(time * 0.35) * 0.012;
    camera.lookAt(0, 1, -3);
   
    // –ü–ª–∞–≤–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–∏
    if (audio && audio.volume < 0.85) {
      audio.volume += 0.0003;
    }
   
    // –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
    if (Math.random() > 0.983) {
      const finalMessages = [
        { text: "üíê –ü—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ –∫—Ä–∞—Å–æ—Ç–æ–π, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ–º –∏ –º–µ–ª–æ–¥–∏—è–º–∏, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä–¥—Ü–µ –∑–∞–º–∏—Ä–∞–µ—Ç! üíê", color: "#e0b0ff" },
        { text: "üìö –ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –≤—Å–µ —ç–∫–∑–∞–º–µ–Ω—ã —Å–¥–∞–≤–∞–ª–∏—Å—å –Ω–∞ ¬´–æ—Ç–ª–∏—á–Ω–æ¬ª —Ç–∞–∫ –∂–µ –ª–µ–≥–∫–æ, –∫–∞–∫ —Ç—ã –ø–æ–¥–ø–µ–≤–∞–µ—à—å –ª—é–±–∏–º—ã–º –ø–µ—Å–Ω—è–º! üìö", color: "#87ceeb" },
        { text: "‚ú® –ü—É—Å—Ç—å –≥—Ä—è–¥—É—â–∏–π –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–µ–±–µ —Å—Ç–æ–ª—å–∫–æ –∂–µ –≤–æ—Å—Ö–∏—â–µ–Ω–∏—è, —Å–∫–æ–ª—å–∫–æ —Ç—ã –¥–∞—Ä–∏—à—å –æ–∫—Ä—É–∂–∞—é—â–∏–º. ‚ú®", color: "#ffb6c1" },
        { text: "ü©∫ –ñ–µ–ª–∞—é —Ç–µ–±–µ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —É—Å–ø–µ—Ö–æ–≤, –Ω–æ –∏ –º–æ—Ä–µ –ª–∏—á–Ω–æ–≥–æ, —Ç–∏—Ö–æ–≥–æ —Å—á–∞—Å—Ç—å—è. ü©∫", color: "#98fb98" },
        { text: "üé§ –ü—É—Å—Ç—å –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏ –±—É–¥–µ—Ç –º–Ω–æ–≥–æ –º—É–∑—ã–∫–∏, —Ç–∞–Ω—Ü–µ–≤ –∏ –º–æ–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫–∏—Ö –∂–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã—Ö, –∫–∞–∫ —Ç—Ä–µ–∫–∏ –õ–∞–∑–∞—Ä–µ–≤–∞! üé§", color: "#ffa07a" },
        { text: "üíå –ñ–µ–ª–∞—é —Ç–µ–±–µ –º–æ—Ä–µ –ª—é–±–≤–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–º—ã—Ö —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏–π! üíå", color: "#dda0dd" }
      ];
      const msgObj = finalMessages[Math.floor(Math.random() * finalMessages.length)];
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞
      const isMobile = window.innerWidth <= 768;
      const fontSize = isMobile ? '18px' : '26px';
      const lineHeight = isMobile ? '1.3' : '1.4';
      const padding = isMobile ? '10px 15px' : '15px 20px';
      
      progressDiv.innerHTML = `
        <div style="
          text-align: center; 
          animation: glow 2s infinite;
          padding: ${padding};
          max-width: 95%;
          margin: 0 auto;
        ">
          <div style="
            font-size: ${fontSize};
            line-height: ${lineHeight};
            color: ${msgObj.color}; 
            text-shadow: 0 0 15px ${msgObj.color};
            word-wrap: break-word;
            overflow-wrap: break-word;
          ">
            ${msgObj.text}
          </div>
        </div>
      `;
    }
  }

  // –í–ê–ñ–ù–û: –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ù–ï–ñ–ò–ù–û–ö –í–û –í–°–ï–• –§–ê–ó–ê–• (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–Ω–µ–≥–æ–ø–∞–¥–∞)
  if (snowStarted) {
    snowflakes.forEach(s => {
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–Ω–µ–∂–∏–Ω–∫–∏
      s.mesh.position.add(s.velocity);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–∫–æ–µ –∫–æ–ª–µ–±–∞–Ω–∏–µ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
      s.mesh.position.x += Math.sin(time * 0.5 + s.mesh.id * 0.1) * 0.001;
      s.mesh.position.z += Math.cos(time * 0.3 + s.mesh.id * 0.1) * 0.001;
      
      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ —É–ø–∞–ª–∏ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ
      if (s.mesh.position.y < -5) {
        s.mesh.position.y = s.resetY;
        s.mesh.position.x = (Math.random() - 0.5) * 25;
        s.mesh.position.z = (Math.random() - 0.5) * 25 - 10;
        
        // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        const scale = Math.random() * 0.8 + 0.6;
        s.mesh.scale.set(scale, scale, scale);
      }
      
      // –õ–µ–≥–∫–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–æ–∫
      if (Math.random() > 0.98) {
        s.mesh.material.opacity = Math.random() * 0.3 + 0.6;
      }
    });
  }
  
  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ü–µ–Ω—ã
  renderer.render(scene, camera);
}
// ==================== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ====================
window.addEventListener('resize', () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
});
</script>

<div id="music-controls">
  <button class="music-btn" id="play-btn">‚ñ∂Ô∏è</button>
  <button class="music-btn" id="pause-btn">‚è∏Ô∏è</button>
  <button class="music-btn" id="volume-up">üîä</button>
  <button class="music-btn" id="volume-down">üîâ</button>

</div>
</body>
</html>
